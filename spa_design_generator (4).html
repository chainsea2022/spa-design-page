<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPAè¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f1f3f4 100%);
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(255,255,255,0.5) 2px, transparent 2px),
        radial-gradient(circle at 75% 75%, rgba(0,0,0,0.03) 1px, transparent 1px);
      background-size: 50px 50px, 30px 30px;
      background-attachment: fixed;
      color: #1a1d29;
      line-height: 1.6;
      font-size: 14px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      min-height: 100vh;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
    }
    
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      color: #1a1d29;
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 20px rgba(0,0,0,0.05);
    }
    
    .header h1 {
      font-size: 1.75rem;
      font-weight: 600;
      color: #1a1d29;
      text-shadow: 0 1px 2px rgba(255,255,255,0.8);
    }
    
    .header-buttons {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      color: #1a1d29;
      position: relative;
      overflow: hidden;
      font-family: inherit;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-header {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(108, 117, 125, 0.3);
      color: #495057;
    }
    
    .btn-header:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: #5B8A72;
      color: #5B8A72;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(91, 138, 114, 0.2);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #5B8A72 0%, #4a7c59 100%);
      color: white;
      border: none;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(91, 138, 114, 0.3);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border: none;
    }
    
    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.3);
    }
    
    .btn-danger {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.3);
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: rgba(156, 163, 175, 0.3);
      color: #9ca3af;
      transform: none !important;
    }
    
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 400px;
      min-height: calc(100vh - 89px);
    }
    
    .form-panel {
      padding: 32px;
      overflow-y: auto;
      max-height: calc(100vh - 89px);
      background: rgba(255, 255, 255, 0.5);
    }
    
    .output-panel {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-left: 1px solid rgba(0,0,0,0.08);
      padding: 32px;
      display: flex;
      flex-direction: column;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0,0,0,0.05);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2, #5B8A72);
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1d29;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      position: relative;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 40px;
      height: 2px;
      background: linear-gradient(90deg, #667eea, #5B8A72);
      border-radius: 2px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    label {
      display: block;
      font-weight: 500;
      color: #1a1d29;
      margin-bottom: 8px;
      font-size: 13px;
    }
    
    input[type="text"], 
    input[type="number"], 
    select, 
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 12px;
      font-size: 13px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(5px);
      color: #1a1d29;
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    input:focus, 
    select:focus, 
    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: rgba(255, 255, 255, 0.95);
      transform: translateY(-1px);
    }
    
    textarea {
      height: 100px;
      resize: vertical;
      font-family: inherit;
    }
    
    .model-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    
    .model-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px 18px;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .model-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), rgba(91, 138, 114, 0.1));
      transition: width 0.3s ease;
    }
    
    .model-item:hover {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    
    .model-item:hover::before {
      width: 100%;
    }
    
    .model-item.selected {
      background: rgba(102, 126, 234, 0.08);
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
    }
    
    .model-item.selected::before {
      width: 100%;
      background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(91, 138, 114, 0.05));
    }
    
    input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(0,0,0,0.2);
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      position: relative;
      margin: 0;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    
    input[type="checkbox"]:hover {
      border-color: #667eea;
      transform: scale(1.05);
    }
    
    input[type="checkbox"]:checked {
      background: linear-gradient(135deg, #667eea 0%, #5B8A72 100%);
      border-color: #667eea;
    }
    
    input[type="checkbox"]:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .model-item label {
      margin: 0;
      font-size: 13px;
      line-height: 1.4;
      cursor: pointer;
      color: #1a1d29;
      font-weight: 400;
      position: relative;
      z-index: 2;
    }
    
    .custom-input {
      margin-top: 8px;
      display: none;
    }
    
    .selected-models-display {
      margin-top: 16px;
      padding: 16px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      font-size: 12px;
      border-left: 4px solid #667eea;
      color: #1a1d29;
      backdrop-filter: blur(5px);
    }
    
    .advice-box {
      background: rgba(102, 126, 234, 0.05);
      border: 1px solid rgba(102, 126, 234, 0.15);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #1a1d29;
      backdrop-filter: blur(5px);
    }
    
    .file-upload {
      position: relative;
      display: block;
      width: 100%;
    }
    
    .file-input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-display {
      padding: 16px;
      border: 2px dashed rgba(0,0,0,0.2);
      border-radius: 12px;
      text-align: center;
      background: rgba(255, 255, 255, 0.6);
      color: #6b7280;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }
    
    .file-display:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
      color: #667eea;
      transform: translateY(-2px);
    }
    
    .generate-btn {
      width: 100%;
      padding: 16px;
      font-size: 15px;
      font-weight: 600;
      margin-top: 24px;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    
    .output-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .output-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1d29;
    }
    
    .output-actions {
      display: flex;
      gap: 8px;
    }
    
    .output-content {
      flex: 1;
      background: rgba(26, 29, 41, 0.95);
      backdrop-filter: blur(10px);
      color: #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-y: auto;
      min-height: 400px;
      max-height: calc(100vh - 300px);
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .toast {
      position: fixed;
      top: 100px;
      right: 20px;
      padding: 16px 20px;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      font-size: 13px;
      z-index: 10000;
      transform: translateX(350px);
      transition: transform 0.4s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success { 
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .toast.error { 
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .toast.info { 
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }
    
    .toast.warning { 
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 9999;
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      padding: 32px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .history-row {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      transition: all 0.3s ease;
    }
    
    .history-row:hover {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    
    .history-control-panel {
      margin-bottom: 16px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6b7280;
      text-align: center;
      padding: 40px;
    }
    
    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      
      .output-panel {
        border-left: none;
        border-top: 1px solid rgba(0,0,0,0.08);
        max-height: 50vh;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        gap: 16px;
        padding: 20px;
      }
      
      .header-buttons {
        width: 100%;
        justify-content: center;
      }
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.05);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>SPAè¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨</h1>
      <div class="header-buttons">
        <button class="btn btn-header" onclick="fillExample()">å¡«å…¥ç¯„ä¾‹</button>
        <button class="btn btn-header" onclick="clearForm()">æ¸…ç©ºè¡¨å–®</button>
        <button class="btn btn-header" onclick="openHistoryModal()">æ­·ç¨‹è¨˜éŒ„</button>
      </div>
    </header>

    <div class="main-layout">
      <div class="form-panel">
        <div class="section">
          <div class="section-title">åŸºæœ¬è³‡è¨Š</div>
          <div class="form-group">
            <label>èª²ç¨‹æ¨™é¡Œ</label>
            <input type="text" id="title" placeholder="è«‹è¼¸å…¥SPAèª²ç¨‹æ¨™é¡Œ..." />
          </div>
          <div class="form-group">
            <label>èª²ç¨‹å…§å®¹æè¿°</label>
            <textarea id="content" placeholder="è«‹è©³ç´°æè¿°èª²ç¨‹å…§å®¹ã€ç‰¹è‰²ã€ç›®æ¨™å®¢ç¾¤ç­‰..."></textarea>
          </div>
        </div>

        <div class="section">
          <div class="section-title">è¨­è¨ˆé¢¨æ ¼è¨­å®š</div>
          <div class="form-grid">
            <div class="form-group">
              <label>é¢¨æ ¼åŸºèª¿</label>
              <select id="style" onchange="handleCustomInput('style', 'styleOther')">
                <option>ç¦ªé¢¨</option>
                <option>æ¥µç°¡</option>
                <option>å¥¢è¯</option>
                <option>è‡ªç„¶</option>
                <option>åº¦å‡</option>
                <option>åŒ—æ­</option>
                <option>éŸ“ç³»</option>
                <option>åŸå¸‚æ‘©ç™»</option>
                <option>æ±æ–¹å¤å…¸</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="styleOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–é¢¨æ ¼..." />
            </div>
            <div class="form-group">
              <label>é¢¨æ ¼èª¿æ€§</label>
              <select id="tone" onchange="handleCustomInput('tone', 'toneOther')">
                <option>ç¾ä»£</option>
                <option>å‚³çµ±</option>
                <option>æ¸…æ–°</option>
                <option>æº«é¦¨</option>
                <option>è¼•å¥¢</option>
                <option>é«˜ç´š</option>
                <option>å°ˆæ¥­</option>
                <option>è—è¡“æ„Ÿ</option>
                <option>æ™‚å°š</option>
                <option>ä¼‘é–’</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="toneOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–èª¿æ€§..." />
            </div>
            <div class="form-group">
              <label>è‰²èª¿ä¸»é¡Œ</label>
              <select id="colorTheme" onchange="handleCustomInput('colorTheme', 'colorThemeOther')">
                <option>ç±³ç™½ç°</option>
                <option>æš–ç™½</option>
                <option>å†·ç°</option>
                <option>æœ¨è³ª</option>
                <option>é»‘é‡‘</option>
                <option>ç²‰è†š</option>
                <option>è–„è·</option>
                <option>é¦™æª³é‡‘</option>
                <option>éŠ€ç™½</option>
                <option>æ¹–æ°´è—</option>
                <option>æ·ºç´«</option>
                <option>è±¡ç‰™ç™½</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="colorThemeOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–è‰²èª¿..." />
            </div>
            <div class="form-group">
              <label>å…‰ç·šæ•ˆæœ</label>
              <select id="lighting" onchange="handleCustomInput('lighting', 'lightingOther')">
                <option>æŸ”å…‰</option>
                <option>æš–å…‰</option>
                <option>å†·å…‰</option>
                <option>èƒŒå…‰</option>
                <option>æ•£æ™¯</option>
                <option>å‡¸å…‰</option>
                <option>èšå…‰</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="lightingOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–å…‰ç·šæ•ˆæœ..." />
            </div>
            <div class="form-group">
              <label>å ´æ™¯èƒŒæ™¯</label>
              <select id="scene" onchange="handleCustomInput('scene', 'sceneOther')">
                <option>å®¤å…§</option>
                <option>è¨ºé–“</option>
                <option>æ£®æ—</option>
                <option>åº­é™¢</option>
                <option>ç™‚ç¨‹åºŠ</option>
                <option>èŠ±åœ’</option>
                <option>ç«¹æ—</option>
                <option>å²©çŸ³æº«æ³‰</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="sceneOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–å ´æ™¯..." />
            </div>
            <div class="form-group">
              <label>æè³ªå…ƒç´ </label>
              <select id="material" onchange="handleCustomInput('material', 'materialOther')">
                <option>æœ¨è³ª</option>
                <option>çŸ³æ</option>
                <option>é‡‘å±¬</option>
                <option>å¸ƒæ–™</option>
                <option>æ°´æµ</option>
                <option>èŠ±è‰</option>
                <option>å¤§ç†çŸ³</option>
                <option>ç«¹ç·¨</option>
                <option>æ£‰éº»</option>
                <option>ç«ç‘°èŠ±ç“£</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="materialOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–æè³ª..." />
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">äººç‰©æ¨¡ç‰¹è¨­å®š</div>
          <div class="model-grid">
            <div class="model-item" onclick="toggleModel(1)">
              <input type="checkbox" id="model1" />
              <label for="model1">å„ªé›…äºæ´²å¥³æ€§ 25-35ï¼Œæ°£è³ªæŸ”å’Œï¼Œçœ¼ç¥é–‰ä¸Šæ”¾é¬†</label>
            </div>
            <div class="model-item" onclick="toggleModel(2)">
              <input type="checkbox" id="model2" />
              <label for="model2">æˆç†Ÿå¥³æ€§ 40+ï¼Œå°ˆæ¥­é†«ç¾ä¿é¤Šæ°›åœ</label>
            </div>
            <div class="model-item" onclick="toggleModel(3)">
              <input type="checkbox" id="model3" />
              <label for="model3">å¹´è¼•å¥³æ€§ 18-25ï¼Œæ¸…æ–°è‡ªç„¶ï¼Œå¾®ç¬‘æ„‰å¿«</label>
            </div>
            <div class="model-item" onclick="toggleModel(4)">
              <input type="checkbox" id="model4" />
              <label for="model4">å•†å‹™ç”·æ€§ 30-40ï¼Œå¥èº«å¾Œæ”¾é¬†</label>
            </div>
            <div class="model-item" onclick="toggleModel(5)">
              <input type="checkbox" id="model5" />
              <label for="model5">é‹å‹•å‹ç”·æ€§ 25-35ï¼Œè‚Œè‚‰ç·šæ¢ï¼Œå¥åº·é¤Šç”Ÿ</label>
            </div>
            <div class="model-item" onclick="toggleModel(6)">
              <input type="checkbox" id="model6" />
              <label for="model6">æƒ…ä¾¶é›™äººï¼Œæµªæ¼«æ°›åœï¼ŒæŒ‰æ‘©åºŠä¸¦æ’</label>
            </div>
            <div class="model-item" onclick="toggleModel(7)">
              <input type="checkbox" id="model7" />
              <label for="model7">æœ‹å‹åŒè¡Œï¼Œé–‹å¿ƒèŠå¤©ï¼Œè¼•é¬†æ°›åœ</label>
            </div>
            <div class="model-item" onclick="toggleModel(8)">
              <input type="checkbox" id="model8" />
              <label for="model8">ç„¡äººå ´æ™¯ï¼Œåƒ…èƒŒæ™¯æˆ–å™¨å…·</label>
            </div>
            <div class="model-item" onclick="toggleModel(9)">
              <input type="checkbox" id="model9" />
              <label for="model9">æ²»ç™‚å¸«æ“ä½œä¸­ï¼Œå°ˆæ¥­æ„Ÿ</label>
            </div>
            <div class="model-item" onclick="toggleModel(10)">
              <input type="checkbox" id="model10" />
              <label for="model10">å¤–åœ‹å¥³æ€§æ¨¡ç‰¹ï¼Œé‡‘é«®ç™½è†šï¼Œé«˜ç´šæ„Ÿ</label>
            </div>
            <div class="model-item" onclick="toggleModel(11)">
              <input type="checkbox" id="model11" />
              <label for="model11">å¤šå…ƒæ—ç¾¤ï¼Œå“ç‰Œåœ‹éš›åŒ–</label>
            </div>
            <div class="model-item" onclick="toggleModel(12)">
              <input type="checkbox" id="model12" />
              <label for="model12">å…¶ä»–</label>
            </div>
          </div>
          <div id="customModelInput" class="form-group full-width" style="display: none; margin-top: 16px;">
            <label>è‡ªå®šç¾©äººç‰©æ¨¡ç‰¹æè¿°</label>
            <textarea id="customModel" placeholder="è«‹è©³ç´°æè¿°æ‚¨æƒ³è¦çš„äººç‰©æ¨¡ç‰¹ç‰¹å¾µã€å¹´é½¡ã€é¢¨æ ¼ç­‰..."></textarea>
          </div>
          <div class="selected-models-display">
            <strong>å·²é¸æ“‡ï¼š</strong><span id="modelList">å°šæœªé¸æ“‡ä»»ä½•æ¨¡ç‰¹é¡å‹</span>
          </div>
        </div>

        <div class="section">
          <div class="section-title">è©³ç´°è¦æ±‚èˆ‡è¦æ ¼è¨­å®š</div>
          <div class="form-group full-width">
            <label>è©³ç´°è¦æ±‚èˆ‡åå¥½ <span style="color: #6B7280; font-weight: 400;">(å»ºè­°å¡«å¯«ï¼Œæå‡æŒ‡ä»¤ç²¾æº–åº¦)</span></label>
            <div class="advice-box">
              <strong>æœ€ä½³å¯¦è¸å»ºè­°ï¼š</strong><br>
              â€¢ <strong>æ§‹åœ–åå¥½ï¼š</strong>ã€Œäººç‰©å±…ä¸­æ§‹åœ–ã€ã€Œå´é¢45åº¦è§’ã€ã€Œå…¨æ™¯å±•ç¤ºç©ºé–“ã€<br>
              â€¢ <strong>å…‰ç·šè¦æ±‚ï¼š</strong>ã€Œè‡ªç„¶å…‰å¾çª—æˆ¶ç‘å…¥ã€ã€Œæš–è‰²èª¿ç‡ˆå…‰ã€ã€ŒæŸ”å’Œå´å…‰ã€<br>
              â€¢ <strong>è‰²å½©åå¥½ï¼š</strong>ã€Œä»¥ç±³ç™½è‰²ç‚ºä¸»èª¿ã€ã€Œé¿å…éæ–¼é®®è±”çš„é¡è‰²ã€<br>
              â€¢ <strong>æ°›åœç‡Ÿé€ ï¼š</strong>ã€Œç‡Ÿé€ æ”¾é¬†ç™‚ç™’æ„Ÿã€ã€Œå±•ç¾å°ˆæ¥­å¯ä¿¡åº¦ã€<br>
              â€¢ <strong>é¿å…å…ƒç´ ï¼š</strong>ã€Œä¸è¦é›œäº‚èƒŒæ™¯ã€ã€Œé¿å…éåº¦è£é£¾ã€<br>
              â€¢ <strong>å“ç‰Œå®šä½ï¼š</strong>ã€Œé‡å°é«˜ç«¯å®¢ç¾¤ã€ã€Œè¦ªæ°‘æº«é¦¨è·¯ç·šã€
            </div>
            <textarea id="detailRequirements" placeholder="è«‹æ ¹æ“šä¸Šæ–¹å»ºè­°ï¼Œè©³ç´°æè¿°æ‚¨çš„åœ–ç‰‡è¦æ±‚..." style="height: 120px;"></textarea>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label>åœ–ç‰‡å¼µæ•¸</label>
              <input type="number" id="imageCount" value="8" min="1" max="20" />
            </div>
            <div class="form-group">
              <label>è¼¸å‡ºå°ºå¯¸</label>
              <select id="dimension">
                <option value="800x800">800x800 (æ­£æ–¹å½¢)</option>
                <option value="1080x1080">1080x1080 (æ­£æ–¹å½¢)</option>
                <option value="1200x628">1200x628 (æ©«å¼)</option>
                <option value="1080x1920">1080x1920 (ç›´å¼)</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label>å„€å™¨è¨­å‚™åœ– <span style="color: #6B7280; font-weight: 400;">(å¯é¸ä¸Šå‚³)</span></label>
              <div class="file-upload">
                <input type="file" id="machineImage" class="file-input" accept="image/*" />
                <div class="file-display">
                  <div>é»æ“Šä¸Šå‚³å„€å™¨åœ–ç‰‡ï¼Œç³»çµ±å°‡æ™ºèƒ½åˆ†æä¸¦ç”Ÿæˆå°ˆæ¥­å±•ç¤ºåœ–</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-success generate-btn" onclick="generateCommand()">
          ç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤
        </button>
      </div>

      <div class="output-panel">
        <div class="output-container">
          <div class="output-header">
            <h3>ç”ŸæˆæŒ‡ä»¤</h3>
            <div class="output-actions">
              <button class="btn btn-primary" onclick="copyToClipboard()">è¤‡è£½</button>
              <button class="btn btn-warning" onclick="goToGemini()">å‰å¾€ Gemini</button>
            </div>
          </div>
          <div class="output-content" id="output">
            <div class="empty-state">
              <div style="font-size: 24px; margin-bottom: 16px; color: #5B8A72;">âœ¨</div>
              <div>é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€é–‹å§‹å‰µå»ºæ‚¨çš„SPAè¨­è¨ˆæŒ‡ä»¤</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="historyModal" class="modal">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h3 style="margin: 0; color: #1a1d29; font-weight: 600;">æ­·ç¨‹ç´€éŒ„</h3>
        <button class="btn btn-header" onclick="closeHistoryModal()">Ã—</button>
      </div>
      <div id="historyContent"></div>
    </div>
  </div>

  <script>
    let commandHistory = [];
    let selectedHistoryItems = [];

    const imageTypes = [
      { name: 'Bannerä¸»è¦–è¦º', description: 'æ ¸å¿ƒå ´æ™¯ï¼šå„ªé›…äºæ´²å¥³æ€§åœ¨é«˜ç´šSPAç’°å¢ƒä¸­äº«å—å°ˆæ¥­é¢éƒ¨è­·ç†', details: 'ä¸»é«”ç´°ç¯€ï¼šå®¢äººå´è‡‰ç‰¹å¯«ï¼Œé–‰çœ¼å®‰è©³è¡¨æƒ…ï¼Œè‚Œè†šå‘ˆç¾å¥åº·é€äº®å…‰æ¾¤ã€‚ç¾å®¹å¸«å°ˆæ³¨æ“ä½œï¼Œå±•ç¾ç†Ÿç·´æ‰‹æ³•ã€‚æ§‹åœ–èˆ‡è¦–è§’ï¼š3/4å´é¢æ§‹åœ–ï¼Œæ·ºæ™¯æ·±æ•ˆæœï¼ŒèƒŒæ™¯æŸ”å’Œè™›åŒ–ï¼Œçªå‡ºä¸»é«”äººç‰©å¯§éœç¾æ„Ÿã€‚ç’°å¢ƒèˆ‡æ°›åœï¼šæº«æš–å°ˆæ¥­SPAæ°›åœï¼Œä¹¾æ·¨ç°¡æ½”ç©ºé–“è¨­è¨ˆï¼ŒæŸ”å’Œè‡ªç„¶å…‰ç·šï¼Œé ç•™å³å´ç©ºé–“ä¾›æ–‡å­—ä½¿ç”¨ã€‚' },
      { name: 'ç™‚ç¨‹ä»‹ç´¹åœ–', description: 'å°ˆæ¥­æ²»ç™‚å¸«æ“ä½œå ´æ™¯', details: 'å±•ç¤ºå…·é«”ç™‚ç¨‹å…§å®¹èˆ‡æµç¨‹ï¼Œå°ˆæ³¨æ–¼æ‰‹æ³•å±•ç¤ºèˆ‡å°ˆæ¥­åº¦é«”ç¾ï¼ŒèƒŒæ™¯ç’°å¢ƒæ¸…æ™°å¯è¦‹ï¼Œå±•ç¾ç™‚ç¨‹çš„å°ˆæ¥­æ€§èˆ‡èˆ’é©æ„Ÿã€‚' },
      { name: 'ç’°å¢ƒç©ºé–“åœ–', description: 'SPAç’°å¢ƒå…¨æ™¯å±•ç¤º', details: 'ç‡Ÿé€ æ”¾é¬†èˆ’é©çš„æ•´é«”ç©ºé–“æ°›åœï¼Œå±•ç¾ç’°å¢ƒçš„å„ªé›…èˆ‡å°ˆæ¥­ï¼ŒåŒ…æ‹¬è¨­æ–½é…ç½®èˆ‡ç©ºé–“è¨­è¨ˆç¾æ„Ÿã€‚' },
      { name: 'å„€å™¨è¨­å‚™åœ–', description: 'å°ˆæ¥­å„€å™¨ç”¢å“ç‰¹å¯«', details: 'çªå‡ºæŠ€è¡“å…ˆé€²æ€§èˆ‡è¨­å‚™å°ˆæ¥­åº¦ï¼Œå±•ç¾å„€å™¨çš„ç²¾å¯†è¨­è¨ˆèˆ‡é«˜å“è³ªè£½é€ å·¥è—ã€‚' },
      { name: 'ç™‚ç¨‹æ•ˆæœåœ–', description: 'å‰å¾Œå°æ¯”æ•ˆæœå±•ç¤º', details: 'è¦–è¦ºåŒ–å±•ç¤ºç™‚ç¨‹æˆæ•ˆï¼Œå¢åŠ èªªæœåŠ›èˆ‡å¯ä¿¡åº¦ï¼Œå±•ç¾å°ˆæ¥­æŠ€è¡“çš„å¯¦éš›æ•ˆæœã€‚' },
      { name: 'å®¢æˆ¶é«”é©—åœ–', description: 'å®¢æˆ¶äº«å—ç™‚ç¨‹çš„æ»¿è¶³ç‹€æ…‹', details: 'æ•æ‰å®¢æˆ¶åœ¨ç™‚ç¨‹ä¸­çš„æ”¾é¬†è¡¨æƒ…èˆ‡æ»¿è¶³æ„Ÿï¼Œå±•ç¾æœå‹™å“è³ªèˆ‡å®¢æˆ¶æ»¿æ„åº¦ã€‚' },
      { name: 'ç”¢å“ä»‹ç´¹åœ–', description: 'é«˜ç´šä¿é¤Šå“å±•ç¤º', details: 'å±•ç¤ºä½¿ç”¨çš„å°ˆæ¥­ç”¢å“èˆ‡ä¿é¤Šå“ï¼Œçªå‡ºç”¢å“å“è³ªèˆ‡å“ç‰Œåƒ¹å€¼ã€‚' },
      { name: 'æ•´é«”åŒ…è£åœ–', description: 'èª²ç¨‹å®Œæ•´åŒ…è£å‘ˆç¾', details: 'ç¶œåˆå±•ç¾èª²ç¨‹çš„æ•´é«”åƒ¹å€¼èˆ‡å¸å¼•åŠ›ï¼Œé©åˆç”¨æ–¼å®£å‚³æ¨å»£èˆ‡ç¤¾ç¾¤åª’é«”ã€‚' }
    ];

    document.addEventListener('DOMContentLoaded', function() {
      loadHistoryFromStorage();
      updateModelSelection();
      initializeFileUpload();
    });

    function loadHistoryFromStorage() {
      try {
        const stored = localStorage.getItem('spaCommandHistory');
        if (stored) {
          commandHistory = JSON.parse(stored);
        }
      } catch (error) {
        console.error('è¼‰å…¥æ­·ç¨‹å¤±æ•—:', error);
        commandHistory = [];
      }
    }

    function saveHistoryToStorage() {
      try {
        localStorage.setItem('spaCommandHistory', JSON.stringify(commandHistory));
      } catch (error) {
        console.error('å„²å­˜æ­·ç¨‹å¤±æ•—:', error);
        showToast('å„²å­˜å¤±æ•—', 'error');
      }
    }

    function toggleModel(modelNum) {
      const checkbox = document.getElementById(`model${modelNum}`);
      const item = checkbox.parentElement;
      
      event.stopPropagation();
      
      checkbox.checked = !checkbox.checked;
      
      if (checkbox.checked) {
        item.classList.add('selected');
      } else {
        item.classList.remove('selected');
      }
      
      if (modelNum === 12) {
        const customInput = document.getElementById('customModelInput');
        if (checkbox.checked) {
          customInput.style.display = 'block';
        } else {
          customInput.style.display = 'none';
          document.getElementById('customModel').value = '';
        }
      }
      
      updateModelSelection();
    }

    function updateModelSelection() {
      const selectedModels = [];
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        const item = checkbox.parentElement;
        
        if (checkbox.checked) {
          item.classList.add('selected');
          const label = checkbox.nextElementSibling.textContent;
          selectedModels.push(label);
        } else {
          item.classList.remove('selected');
        }
      }
      
      const customModelCheckbox = document.getElementById('model12');
      const customModelText = document.getElementById('customModel').value;
      if (customModelCheckbox.checked && customModelText.trim()) {
        selectedModels[selectedModels.length - 1] = customModelText.trim();
      }
      
      const modelList = document.getElementById('modelList');
      if (selectedModels.length === 0) {
        modelList.textContent = 'å°šæœªé¸æ“‡ä»»ä½•æ¨¡ç‰¹é¡å‹';
        modelList.style.color = '#6B7280';
      } else {
        modelList.textContent = selectedModels.join('ã€');
        modelList.style.color = '#1a1d29';
      }
    }

    function handleCustomInput(selectId, inputId) {
      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);
      
      if (select.value === 'å…¶ä»–') {
        input.style.display = 'block';
        input.focus();
      } else {
        input.style.display = 'none';
        input.value = '';
      }
    }

    function getSelectedValue(selectId, inputId) {
      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);
      
      if (select.value === 'å…¶ä»–' && input.value.trim()) {
        return input.value.trim();
      }
      return select.value;
    }

    function initializeFileUpload() {
      const fileInput = document.getElementById('machineImage');
      const fileDisplay = fileInput.nextElementSibling;
      
      fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          const fileName = this.files[0].name;
          fileDisplay.innerHTML = `<div style="color: #5B8A72;">âœ“ å·²é¸æ“‡: ${fileName}</div><div style="font-size: 11px; margin-top: 4px;">ç³»çµ±å°‡æ™ºèƒ½åˆ†ææ­¤å„€å™¨ä¸¦ç”Ÿæˆå°ˆæ¥­å±•ç¤ºåœ–</div>`;
          fileDisplay.style.borderColor = '#5B8A72';
          fileDisplay.style.background = 'rgba(91, 138, 114, 0.1)';
        } else {
          fileDisplay.innerHTML = `<div>é»æ“Šä¸Šå‚³å„€å™¨åœ–ç‰‡ï¼Œç³»çµ±å°‡æ™ºèƒ½åˆ†æä¸¦ç”Ÿæˆå°ˆæ¥­å±•ç¤ºåœ–</div>`;
          fileDisplay.style.borderColor = 'rgba(0,0,0,0.2)';
          fileDisplay.style.background = 'rgba(255, 255, 255, 0.6)';
        }
      });
    }

    function fillExample() {
      document.getElementById('title').value = 'é€†æ™‚å…‰æ¢é›™äº«SPA';
      document.getElementById('content').value = `**å¥³æ€§ä»»é¸2éƒ¨ä½ï¼šè…°è…¹ / è‡€è…¿ / æ‰‹è‡‚ ç”·æ€§æ“ä½œéƒ¨ä½ï¼šå¾ŒèƒŒ / è‚šå­**

1. å…¨èƒŒå°ˆæ¥­æ‰‹æŠ€èˆ’å£“ 30åˆ†é˜
2. ç†±æ—‹é¢¨èˆ’å£“è­·ç† 30åˆ†é˜
3. è‚ŒåŠ›æ´»åŒ–é›™æ•ˆå„€ 20åˆ†é˜
4. è…¿éƒ¨æ·‹å·´æ’æ°´ 30åˆ†é˜
5. é ­éƒ¨æ”¾é¬†è­·ç† 10åˆ†é˜

é©åˆ25-50æ­²è¿½æ±‚è‚Œè†šå¹´è¼•åŒ–çš„éƒ½æœƒäººå£«
ä¸»æ‰“é€†è½‰è‚Œé½¡ï¼Œé‡ç¾é’æ˜¥å…‰é‡‡`;
      
      document.getElementById('style').value = 'æ¥µç°¡';
      document.getElementById('tone').value = 'å°ˆæ¥­';
      document.getElementById('colorTheme').value = 'ç±³ç™½ç°';
      document.getElementById('lighting').value = 'æŸ”å…‰';
      document.getElementById('scene').value = 'è¨ºé–“';
      document.getElementById('material').value = 'å¤§ç†çŸ³';
      
      document.getElementById('model1').checked = true;
      document.getElementById('model8').checked = true;
      updateModelSelection();
      
      showToast('ç¯„ä¾‹è³‡æ–™å·²å¡«å…¥', 'success');
    }

    function clearForm() {
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('detailRequirements').value = '';
      
      const selects = document.querySelectorAll('select');
      selects.forEach(select => select.selectedIndex = 0);
      
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        checkbox.checked = false;
      }
      
      document.getElementById('machineImage').value = '';
      document.getElementById('customModel').value = '';
      document.getElementById('customModelInput').style.display = 'none';
      
      const fileDisplay = document.querySelector('.file-display');
      fileDisplay.innerHTML = `<div>é»æ“Šä¸Šå‚³å„€å™¨åœ–ç‰‡ï¼Œç³»çµ±å°‡æ™ºèƒ½åˆ†æä¸¦ç”Ÿæˆå°ˆæ¥­å±•ç¤ºåœ–</div>`;
      fileDisplay.style.borderColor = 'rgba(0,0,0,0.2)';
      fileDisplay.style.background = 'rgba(255, 255, 255, 0.6)';
      
      const customInputs = ['styleOther', 'toneOther', 'colorThemeOther', 'lightingOther', 'sceneOther', 'materialOther'];
      customInputs.forEach(id => {
        const input = document.getElementById(id);
        input.style.display = 'none';
        input.value = '';
      });
      
      document.getElementById('output').innerHTML = `
        <div class="empty-state">
          <div style="font-size: 24px; margin-bottom: 16px; color: #5B8A72;">âœ¨</div>
          <div>é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€é–‹å§‹å‰µå»ºæ‚¨çš„SPAè¨­è¨ˆæŒ‡ä»¤</div>
        </div>
      `;
      
      updateModelSelection();
      showToast('è¡¨å–®å·²æ¸…ç©º', 'info');
    }

    function parseContentSteps(content) {
      const steps = [];
      const lines = content.split('\n');
      
      lines.forEach(line => {
        const match = line.match(/^\d+\.\s*(.+)/);
        if (match) {
          steps.push(match[1].trim());
        }
      });
      
      return steps.length > 0 ? steps : ['å°ˆæ¥­SPAç™‚ç¨‹'];
    }

    function generateMachineAnalysis(machineFile) {
      return `
ã€å„€å™¨å±•ç¤ºåœ–ã€‘è«‹åƒè€ƒä¸Šå‚³åœ–ç‰‡é¢¨æ ¼ç”Ÿæˆ3å¼µï¼š
1. é«˜ç´šç¾å®¹å„€å™¨ç”¢å“æ”å½±ï¼šç™½è‰²/éŠ€è‰²ç¾ä»£è¨­è¨ˆï¼Œ45åº¦å±•ç¤ºè§’åº¦ï¼Œç´”ç™½èƒŒæ™¯ï¼Œå°ˆæ¥­æ”å½±æ£šå…‰ç·šï¼Œç„¡æ–‡å­—ç„¡logo
2. SPAæ²»ç™‚å ´æ™¯ï¼šå°ˆæ¥­æ²»ç™‚å¸«æ“ä½œåŒæ¬¾å„€å™¨ï¼Œå®¢äººäº«å—ç™‚ç¨‹ï¼Œæº«é¦¨è¨ºé–“ç’°å¢ƒï¼Œè‡ªç„¶å…‰ç·šï¼Œè¨­è¨ˆæ„Ÿå ´æ™¯
3. ç²¾å“SPAç©ºé–“ï¼šç¾ä»£ç¾å®¹è¨­å‚™èå…¥é«˜ç´šç©ºé–“è¨­è¨ˆï¼Œç°¡ç´„å¥¢è¯é¢¨æ ¼ï¼ŒæŸ”å’Œç‡ˆå…‰ï¼Œç´”ç²¹è¦–è¦ºç¾æ„Ÿ

å…¨éƒ¨è¦æ±‚ï¼šåƒè€ƒä¸Šå‚³å„€å™¨å¤–è§€ç‰¹å¾µï¼Œä½†ä»¥è¨­è¨ˆç¾æ„Ÿç‚ºä¸»ï¼Œç„¡ä»»ä½•æ–‡å­—æ¨™ç¤ºï¼Œç´”è¦–è¦ºå±•ç¤ºã€‚`;
    }

    function generateCommand() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const detailRequirements = document.getElementById('detailRequirements').value;
      
      if (!title || !content) {
        showToast('è«‹å¡«å…¥èª²ç¨‹æ¨™é¡Œå’Œå…§å®¹', 'error');
        return;
      }

      const style = getSelectedValue('style', 'styleOther');
      const tone = getSelectedValue('tone', 'toneOther');
      const colorTheme = getSelectedValue('colorTheme', 'colorThemeOther');
      const lighting = getSelectedValue('lighting', 'lightingOther');
      const scene = getSelectedValue('scene', 'sceneOther');
      const material = getSelectedValue('material', 'materialOther');
      
      const dimension = document.getElementById('dimension').value;
      const imageCount = parseInt(document.getElementById('imageCount').value);

      const modelOptions = [];
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        if (checkbox.checked) {
          if (i === 12) {
            const customText = document.getElementById('customModel').value.trim();
            if (customText) {
              modelOptions.push(customText);
            } else {
              modelOptions.push('å…¶ä»–å®¢è£½åŒ–');
            }
          } else {
            const label = checkbox.nextElementSibling.textContent;
            modelOptions.push(label);
          }
        }
      }

      const courseSteps = parseContentSteps(content);

      let prompt = `è«‹ç”Ÿæˆ${imageCount}å¼µç´”è¦–è¦ºè¨­è¨ˆåœ–ç‰‡ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨å®Œæˆï¼š

ä¸»é¡Œï¼š${title}
é¢¨æ ¼ï¼š${style}${tone}ï¼Œ${colorTheme}è‰²èª¿ï¼Œ${lighting}ï¼Œ${scene}ç’°å¢ƒ
`;

      if (modelOptions.length > 0) {
        prompt += `äººç‰©ï¼š${modelOptions.join('ã€')}\n`;
      }

      if (detailRequirements.trim()) {
        prompt += `è¦æ±‚ï¼š${detailRequirements}\n`;
      }

      prompt += '\né‡è¦ï¼šæ‰€æœ‰åœ–ç‰‡éƒ½æ˜¯ç´”è¨­è¨ˆæ„Ÿè¦–è¦ºå‘ˆç¾ï¼Œä¸åŒ…å«ä»»ä½•æ–‡å­—ã€æ¨™èªã€å“ç‰Œåç¨±æˆ–èªªæ˜æ–‡å­—ã€‚\n\n';

      for (let i = 1; i <= imageCount; i++) {
        const imageType = imageTypes[(i - 1) % imageTypes.length];
        const relatedStep = courseSteps[(i - 1) % courseSteps.length] || '';
        
        prompt += `åœ–${i}ï¼š${imageType.description}ï¼Œé«”ç¾"${relatedStep}"ç™‚ç¨‹ç²¾ç¥ï¼Œ${colorTheme}è‰²èª¿ï¼Œ${dimension}ï¼Œè¨­è¨ˆæ„ŸèƒŒæ™¯ï¼Œç„¡æ–‡å­—ç´”è¦–è¦º\n`;
      }

      const machineFile = document.getElementById('machineImage').files[0];
      if (machineFile) {
        prompt += '\n' + generateMachineAnalysis(machineFile);
      }

      prompt += '\nç«‹å³ç”Ÿæˆå…¨éƒ¨åœ–ç‰‡ï¼Œç´”è¦–è¦ºè¨­è¨ˆæ„Ÿï¼Œç„¡ä»»ä½•æ–‡å­—å…§å®¹ã€‚';

      document.getElementById('output').textContent = prompt;
      saveToHistory(title, prompt);
      showToast(`å·²ç”Ÿæˆ${imageCount}å¼µç´”è¨­è¨ˆåœ–åƒæŒ‡ä»¤`, 'success');
    }

    function copyToClipboard() {
      const output = document.getElementById('output');
      if (!output.textContent || output.textContent.includes('é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€')) {
        showToast('è«‹å…ˆç”ŸæˆæŒ‡ä»¤', 'error');
        return;
      }
      
      navigator.clipboard.writeText(output.textContent).then(() => {
        showToast('æŒ‡ä»¤å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
      }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = output.textContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('æŒ‡ä»¤å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
      });
    }

    function goToGemini() {
      const output = document.getElementById('output');
      if (!output.textContent || output.textContent.includes('é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€')) {
        showToast('è«‹å…ˆç”ŸæˆæŒ‡ä»¤', 'error');
        return;
      }
      
      copyToClipboard();
      window.open('https://gemini.google.com/', '_blank');
      showToast('å·²é–‹å•ŸGeminiï¼ŒæŒ‡ä»¤å·²è¤‡è£½', 'info');
    }

    function showToast(message, type = 'info') {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function saveToHistory(title, command) {
      const historyItem = {
        id: Date.now(),
        title: title,
        command: command,
        timestamp: new Date().toLocaleString('zh-TW')
      };
      
      commandHistory.unshift(historyItem);
      
      if (commandHistory.length > 20) {
        commandHistory = commandHistory.slice(0, 20);
      }
      
      saveHistoryToStorage();
    }

    function openHistoryModal() {
      const modal = document.getElementById('historyModal');
      modal.style.display = 'block';
      renderHistoryContent();
      
      modal.onclick = function(event) {
        if (event.target === modal) {
          closeHistoryModal();
        }
      };
    }

    function closeHistoryModal() {
      const modal = document.getElementById('historyModal');
      modal.style.display = 'none';
      selectedHistoryItems = [];
    }

    function renderHistoryContent() {
      const content = document.getElementById('historyContent');
      
      if (commandHistory.length === 0) {
        content.innerHTML = `
          <div style="text-align: center; color: #6B7280; padding: 40px;">
            <div style="font-size: 32px; margin-bottom: 16px;">ğŸ“</div>
            <div>å°šç„¡æ­·ç¨‹è¨˜éŒ„</div>
          </div>
        `;
        return;
      }
      
      let html = `
        <div class="history-control-panel">
          <div>
            <span style="font-size: 14px; font-weight: 500;">å…± ${commandHistory.length} ç­†è¨˜éŒ„</span>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-danger" onclick="clearAllHistory()" style="font-size: 11px; padding: 6px 12px;">æ¸…ç©ºå…¨éƒ¨</button>
          </div>
        </div>
      `;
      
      commandHistory.forEach((item, index) => {
        html += `
          <div class="history-row" onclick="showHistoryDetail(${index})">
            <div style="flex: 1;">
              <div style="font-weight: 500; color: #1a1d29; margin-bottom: 4px; font-size: 14px;">${item.title}</div>
              <div style="font-size: 12px; color: #6B7280;">${item.timestamp}</div>
            </div>
          </div>
        `;
      });
      
      content.innerHTML = html;
    }

    function showHistoryDetail(index) {
      const item = commandHistory[index];
      const content = document.getElementById('historyContent');
      
      content.innerHTML = `
        <div>
          <button class="btn btn-primary" onclick="renderHistoryContent()" style="margin-bottom: 16px;">â† è¿”å›åˆ—è¡¨</button>
          <h4 style="margin-bottom: 8px; color: #1a1d29; font-weight: 600;">${item.title}</h4>
          <p style="color: #6B7280; font-size: 12px; margin-bottom: 16px;">${item.timestamp}</p>
          <div style="background: rgba(26, 29, 41, 0.05); padding: 16px; border-radius: 12px; font-family: monospace; font-size: 11px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; border: 1px solid rgba(0,0,0,0.08);">${item.command}</div>
          <div style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="loadHistoryCommand(${index})">è¼‰å…¥æŒ‡ä»¤</button>
            <button class="btn btn-success" onclick="copyHistoryCommand(${index})">è¤‡è£½æŒ‡ä»¤</button>
            <button class="btn btn-danger" onclick="deleteHistoryItem(${index})">åˆªé™¤æ­¤é …</button>
          </div>
        </div>
      `;
    }

    function deleteHistoryItem(index) {
      try {
        if (!commandHistory || !commandHistory[index]) {
          showToast('æ‰¾ä¸åˆ°è¦åˆªé™¤çš„é …ç›®', 'error');
          return;
        }
        
        if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é …ç›®å—ï¼Ÿ')) {
          commandHistory.splice(index, 1);
          localStorage.setItem('spaCommandHistory', JSON.stringify(commandHistory));
          renderHistoryContent();
          showToast('é …ç›®å·²æˆåŠŸåˆªé™¤', 'success');
        }
      } catch (error) {
        showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦', 'error');
        console.error('åˆªé™¤éŒ¯èª¤:', error);
      }
    }

    function loadHistoryCommand(index) {
      const item = commandHistory[index];
      document.getElementById('output').textContent = item.command;
      closeHistoryModal();
      showToast('æ­·ç¨‹æŒ‡ä»¤å·²è¼‰å…¥', 'success');
    }

    function copyHistoryCommand(index) {
      const item = commandHistory[index];
      
      navigator.clipboard.writeText(item.command).then(() => {
        showToast('æ­·ç¨‹æŒ‡ä»¤å·²è¤‡è£½', 'success');
      });
    }

    function clearAllHistory() {
      commandHistory = [];
      try {
        localStorage.removeItem('spaCommandHistory');
      } catch (error) {
        console.error('æ¸…é™¤å„²å­˜å¤±æ•—:', error);
      }
      renderHistoryContent();
      showToast('æ‰€æœ‰æ­·ç¨‹å·²æ¸…ç©º', 'info');
    }

    // å…¨åŸŸå‡½æ•¸å®šç¾© - ç¢ºä¿å‡½æ•¸å¯ä»¥è¢« onclick èª¿ç”¨
    window.fillExample = fillExample;
    window.clearForm = clearForm;
    window.openHistoryModal = openHistoryModal;
    window.closeHistoryModal = closeHistoryModal;
    window.renderHistoryContent = renderHistoryContent;
    window.showHistoryDetail = showHistoryDetail;
    window.deleteHistoryItem = deleteHistoryItem;
    window.loadHistoryCommand = loadHistoryCommand;
    window.copyHistoryCommand = copyHistoryCommand;
    window.clearAllHistory = clearAllHistory;
    window.generateCommand = generateCommand;
    window.copyToClipboard = copyToClipboard;
    window.goToGemini = goToGemini;
    window.toggleModel = toggleModel;
    window.handleCustomInput = handleCustomInput;
    document.addEventListener('DOMContentLoaded', function() {
      const customModelTextarea = document.getElementById('customModel');
      if (customModelTextarea) {
        customModelTextarea.addEventListener('input', updateModelSelection);
      }
    });

    // ç›£è½æŒ‰éµäº‹ä»¶
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('historyModal');
        if (modal && modal.style.display === 'block') {
          closeHistoryModal();
        }
      }
    });

    // é˜²æ­¢checkboxé»æ“Šæ™‚è§¸ç™¼çˆ¶å…ƒç´ äº‹ä»¶
    document.addEventListener('DOMContentLoaded', function() {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', function(event) {
          event.stopPropagation();
        });
      });
    });

    console.log('SPAè¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨å·²è¼‰å…¥å®Œæˆ');
  </script>
</body>
</html>