<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPA設計指令生成器</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f1f3f4 100%);
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(255,255,255,0.5) 2px, transparent 2px),
        radial-gradient(circle at 75% 75%, rgba(0,0,0,0.03) 1px, transparent 1px);
      background-size: 50px 50px, 30px 30px;
      background-attachment: fixed;
      color: #1a1d29;
      line-height: 1.6;
      font-size: 14px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      min-height: 100vh;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
    }
    
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      color: #1a1d29;
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 20px rgba(0,0,0,0.05);
    }
    
    .header h1 {
      font-size: 1.75rem;
      font-weight: 600;
      color: #1a1d29;
      text-shadow: 0 1px 2px rgba(255,255,255,0.8);
    }
    
    .header-buttons {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      color: #1a1d29;
      position: relative;
      overflow: hidden;
      font-family: inherit;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-header {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(108, 117, 125, 0.3);
      color: #495057;
    }
    
    .btn-header:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: #5B8A72;
      color: #5B8A72;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(91, 138, 114, 0.2);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #5B8A72 0%, #4a7c59 100%);
      color: white;
      border: none;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(91, 138, 114, 0.3);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border: none;
    }
    
    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.3);
    }
    
    .btn-danger {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.3);
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: rgba(156, 163, 175, 0.3);
      color: #9ca3af;
      transform: none !important;
    }
    
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 400px;
      min-height: calc(100vh - 89px);
    }
    
    .form-panel {
      padding: 32px;
      overflow-y: auto;
      max-height: calc(100vh - 89px);
      background: rgba(255, 255, 255, 0.5);
    }
    
    .output-panel {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-left: 1px solid rgba(0,0,0,0.08);
      padding: 32px;
      display: flex;
      flex-direction: column;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0,0,0,0.05);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2, #5B8A72);
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1d29;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      position: relative;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 40px;
      height: 2px;
      background: linear-gradient(90deg, #667eea, #5B8A72);
      border-radius: 2px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    label {
      display: block;
      font-weight: 500;
      color: #1a1d29;
      margin-bottom: 8px;
      font-size: 13px;
    }
    
    input[type="text"], 
    input[type="number"], 
    select, 
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 12px;
      font-size: 13px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(5px);
      color: #1a1d29;
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    input:focus, 
    select:focus, 
    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: rgba(255, 255, 255, 0.95);
      transform: translateY(-1px);
    }
    
    textarea {
      height: 100px;
      resize: vertical;
      font-family: inherit;
    }
    
    .model-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    
    .model-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px 18px;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .model-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), rgba(91, 138, 114, 0.1));
      transition: width 0.3s ease;
    }
    
    .model-item:hover {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    
    .model-item:hover::before {
      width: 100%;
    }
    
    .model-item.selected {
      background: rgba(102, 126, 234, 0.08);
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
    }
    
    .model-item.selected::before {
      width: 100%;
      background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(91, 138, 114, 0.05));
    }
    
    input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(0,0,0,0.2);
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      position: relative;
      margin: 0;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    
    input[type="checkbox"]:hover {
      border-color: #667eea;
      transform: scale(1.05);
    }
    
    input[type="checkbox"]:checked {
      background: linear-gradient(135deg, #667eea 0%, #5B8A72 100%);
      border-color: #667eea;
    }
    
    input[type="checkbox"]:checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .model-item label {
      margin: 0;
      font-size: 13px;
      line-height: 1.4;
      cursor: pointer;
      color: #1a1d29;
      font-weight: 400;
      position: relative;
      z-index: 2;
    }
    
    .custom-input {
      margin-top: 8px;
      display: none;
    }
    
    .selected-models-display {
      margin-top: 16px;
      padding: 16px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      font-size: 12px;
      border-left: 4px solid #667eea;
      color: #1a1d29;
      backdrop-filter: blur(5px);
    }
    
    .advice-box {
      background: rgba(102, 126, 234, 0.05);
      border: 1px solid rgba(102, 126, 234, 0.15);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #1a1d29;
      backdrop-filter: blur(5px);
    }
    
    .file-upload {
      position: relative;
      display: block;
      width: 100%;
    }
    
    .file-input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-display {
      padding: 16px;
      border: 2px dashed rgba(0,0,0,0.2);
      border-radius: 12px;
      text-align: center;
      background: rgba(255, 255, 255, 0.6);
      color: #6b7280;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }
    
    .file-display:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
      color: #667eea;
      transform: translateY(-2px);
    }
    
    .generate-btn {
      width: 100%;
      padding: 16px;
      font-size: 15px;
      font-weight: 600;
      margin-top: 24px;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    
    .output-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .output-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1d29;
    }
    
    .output-actions {
      display: flex;
      gap: 8px;
    }
    
    .output-content {
      flex: 1;
      background: rgba(26, 29, 41, 0.95);
      backdrop-filter: blur(10px);
      color: #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-y: auto;
      min-height: 400px;
      max-height: calc(100vh - 300px);
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .toast {
      position: fixed;
      top: 100px;
      right: 20px;
      padding: 16px 20px;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      font-size: 13px;
      z-index: 10000;
      transform: translateX(350px);
      transition: transform 0.4s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success { 
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .toast.error { 
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .toast.info { 
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }
    
    .toast.warning { 
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 9999;
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      padding: 32px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .history-row {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      transition: all 0.3s ease;
    }
    
    .history-row:hover {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    
    .history-control-panel {
      margin-bottom: 16px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6b7280;
      text-align: center;
      padding: 40px;
    }
    
    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      
      .output-panel {
        border-left: none;
        border-top: 1px solid rgba(0,0,0,0.08);
        max-height: 50vh;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        gap: 16px;
        padding: 20px;
      }
      
      .header-buttons {
        width: 100%;
        justify-content: center;
      }
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.05);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>SPA設計指令生成器</h1>
      <div class="header-buttons">
        <button class="btn btn-header" onclick="fillExample()">填入範例</button>
        <button class="btn btn-header" onclick="clearForm()">清空表單</button>
        <button class="btn btn-header" onclick="openHistoryModal()">歷程記錄</button>
      </div>
    </header>

    <div class="main-layout">
      <div class="form-panel">
        <div class="section">
          <div class="section-title">基本資訊</div>
          <div class="form-group">
            <label>課程標題</label>
            <input type="text" id="title" placeholder="請輸入SPA課程標題..." />
          </div>
          <div class="form-group">
            <label>課程內容描述</label>
            <textarea id="content" placeholder="請詳細描述課程內容、特色、目標客群等..."></textarea>
          </div>
        </div>

        <div class="section">
          <div class="section-title">設計風格設定</div>
          <div class="form-grid">
            <div class="form-group">
              <label>風格基調</label>
              <select id="style" onchange="handleCustomInput('style', 'styleOther')">
                <option>禪風</option>
                <option>極簡</option>
                <option>奢華</option>
                <option>自然</option>
                <option>度假</option>
                <option>北歐</option>
                <option>韓系</option>
                <option>城市摩登</option>
                <option>東方古典</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="styleOther" class="custom-input" placeholder="請輸入其他風格..." />
            </div>
            <div class="form-group">
              <label>風格調性</label>
              <select id="tone" onchange="handleCustomInput('tone', 'toneOther')">
                <option>現代</option>
                <option>傳統</option>
                <option>清新</option>
                <option>溫馨</option>
                <option>輕奢</option>
                <option>高級</option>
                <option>專業</option>
                <option>藝術感</option>
                <option>時尚</option>
                <option>休閒</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="toneOther" class="custom-input" placeholder="請輸入其他調性..." />
            </div>
            <div class="form-group">
              <label>色調主題</label>
              <select id="colorTheme" onchange="handleCustomInput('colorTheme', 'colorThemeOther')">
                <option>米白灰</option>
                <option>暖白</option>
                <option>冷灰</option>
                <option>木質</option>
                <option>黑金</option>
                <option>粉膚</option>
                <option>薄荷</option>
                <option>香檳金</option>
                <option>銀白</option>
                <option>湖水藍</option>
                <option>淺紫</option>
                <option>象牙白</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="colorThemeOther" class="custom-input" placeholder="請輸入其他色調..." />
            </div>
            <div class="form-group">
              <label>光線效果</label>
              <select id="lighting" onchange="handleCustomInput('lighting', 'lightingOther')">
                <option>柔光</option>
                <option>暖光</option>
                <option>冷光</option>
                <option>背光</option>
                <option>散景</option>
                <option>凸光</option>
                <option>聚光</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="lightingOther" class="custom-input" placeholder="請輸入其他光線效果..." />
            </div>
            <div class="form-group">
              <label>場景背景</label>
              <select id="scene" onchange="handleCustomInput('scene', 'sceneOther')">
                <option>室內</option>
                <option>診間</option>
                <option>森林</option>
                <option>庭院</option>
                <option>療程床</option>
                <option>花園</option>
                <option>竹林</option>
                <option>岩石溫泉</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="sceneOther" class="custom-input" placeholder="請輸入其他場景..." />
            </div>
            <div class="form-group">
              <label>材質元素</label>
              <select id="material" onchange="handleCustomInput('material', 'materialOther')">
                <option>木質</option>
                <option>石材</option>
                <option>金屬</option>
                <option>布料</option>
                <option>水流</option>
                <option>花草</option>
                <option>大理石</option>
                <option>竹編</option>
                <option>棉麻</option>
                <option>玫瑰花瓣</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="materialOther" class="custom-input" placeholder="請輸入其他材質..." />
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">人物模特設定</div>
          <div class="model-grid">
            <div class="model-item" onclick="toggleModel(1)">
              <input type="checkbox" id="model1" />
              <label for="model1">優雅亞洲女性 25-35，氣質柔和，眼神閉上放鬆</label>
            </div>
            <div class="model-item" onclick="toggleModel(2)">
              <input type="checkbox" id="model2" />
              <label for="model2">成熟女性 40+，專業醫美保養氛圍</label>
            </div>
            <div class="model-item" onclick="toggleModel(3)">
              <input type="checkbox" id="model3" />
              <label for="model3">年輕女性 18-25，清新自然，微笑愉快</label>
            </div>
            <div class="model-item" onclick="toggleModel(4)">
              <input type="checkbox" id="model4" />
              <label for="model4">商務男性 30-40，健身後放鬆</label>
            </div>
            <div class="model-item" onclick="toggleModel(5)">
              <input type="checkbox" id="model5" />
              <label for="model5">運動型男性 25-35，肌肉線條，健康養生</label>
            </div>
            <div class="model-item" onclick="toggleModel(6)">
              <input type="checkbox" id="model6" />
              <label for="model6">情侶雙人，浪漫氛圍，按摩床並排</label>
            </div>
            <div class="model-item" onclick="toggleModel(7)">
              <input type="checkbox" id="model7" />
              <label for="model7">朋友同行，開心聊天，輕鬆氛圍</label>
            </div>
            <div class="model-item" onclick="toggleModel(8)">
              <input type="checkbox" id="model8" />
              <label for="model8">無人場景，僅背景或器具</label>
            </div>
            <div class="model-item" onclick="toggleModel(9)">
              <input type="checkbox" id="model9" />
              <label for="model9">治療師操作中，專業感</label>
            </div>
            <div class="model-item" onclick="toggleModel(10)">
              <input type="checkbox" id="model10" />
              <label for="model10">外國女性模特，金髮白膚，高級感</label>
            </div>
            <div class="model-item" onclick="toggleModel(11)">
              <input type="checkbox" id="model11" />
              <label for="model11">多元族群，品牌國際化</label>
            </div>
            <div class="model-item" onclick="toggleModel(12)">
              <input type="checkbox" id="model12" />
              <label for="model12">其他</label>
            </div>
          </div>
          <div id="customModelInput" class="form-group full-width" style="display: none; margin-top: 16px;">
            <label>自定義人物模特描述</label>
            <textarea id="customModel" placeholder="請詳細描述您想要的人物模特特徵、年齡、風格等..."></textarea>
          </div>
          <div class="selected-models-display">
            <strong>已選擇：</strong><span id="modelList">尚未選擇任何模特類型</span>
          </div>
        </div>

        <div class="section">
          <div class="section-title">詳細要求與規格設定</div>
          <div class="form-group full-width">
            <label>詳細要求與偏好 <span style="color: #6B7280; font-weight: 400;">(建議填寫，提升指令精準度)</span></label>
            <div class="advice-box">
              <strong>最佳實踐建議：</strong><br>
              • <strong>構圖偏好：</strong>「人物居中構圖」「側面45度角」「全景展示空間」<br>
              • <strong>光線要求：</strong>「自然光從窗戶灑入」「暖色調燈光」「柔和側光」<br>
              • <strong>色彩偏好：</strong>「以米白色為主調」「避免過於鮮豔的顏色」<br>
              • <strong>氛圍營造：</strong>「營造放鬆療癒感」「展現專業可信度」<br>
              • <strong>避免元素：</strong>「不要雜亂背景」「避免過度裝飾」<br>
              • <strong>品牌定位：</strong>「針對高端客群」「親民溫馨路線」
            </div>
            <textarea id="detailRequirements" placeholder="請根據上方建議，詳細描述您的圖片要求..." style="height: 120px;"></textarea>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label>圖片張數</label>
              <input type="number" id="imageCount" value="8" min="1" max="20" />
            </div>
            <div class="form-group">
              <label>輸出尺寸</label>
              <select id="dimension">
                <option value="800x800">800x800 (正方形)</option>
                <option value="1080x1080">1080x1080 (正方形)</option>
                <option value="1200x628">1200x628 (橫式)</option>
                <option value="1080x1920">1080x1920 (直式)</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label>儀器設備圖 <span style="color: #6B7280; font-weight: 400;">(可選上傳)</span></label>
              <div class="file-upload">
                <input type="file" id="machineImage" class="file-input" accept="image/*" />
                <div class="file-display">
                  <div>點擊上傳儀器圖片，系統將智能分析並生成專業展示圖</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-success generate-btn" onclick="generateCommand()">
          生成專業AI指令
        </button>
      </div>

      <div class="output-panel">
        <div class="output-container">
          <div class="output-header">
            <h3>生成指令</h3>
            <div class="output-actions">
              <button class="btn btn-primary" onclick="copyToClipboard()">複製</button>
              <button class="btn btn-warning" onclick="goToGemini()">前往 Gemini</button>
            </div>
          </div>
          <div class="output-content" id="output">
            <div class="empty-state">
              <div style="font-size: 24px; margin-bottom: 16px; color: #5B8A72;">✨</div>
              <div>點擊「生成專業AI指令」開始創建您的SPA設計指令</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="historyModal" class="modal">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h3 style="margin: 0; color: #1a1d29; font-weight: 600;">歷程紀錄</h3>
        <button class="btn btn-header" onclick="closeHistoryModal()">×</button>
      </div>
      <div id="historyContent"></div>
    </div>
  </div>

  <script>
    let commandHistory = [];
    let selectedHistoryItems = [];

    const imageTypes = [
      { name: 'Banner主視覺', description: '核心場景：優雅亞洲女性在高級SPA環境中享受專業面部護理', details: '主體細節：客人側臉特寫，閉眼安詳表情，肌膚呈現健康透亮光澤。美容師專注操作，展現熟練手法。構圖與視角：3/4側面構圖，淺景深效果，背景柔和虛化，突出主體人物寧靜美感。環境與氛圍：溫暖專業SPA氛圍，乾淨簡潔空間設計，柔和自然光線，預留右側空間供文字使用。' },
      { name: '療程介紹圖', description: '專業治療師操作場景', details: '展示具體療程內容與流程，專注於手法展示與專業度體現，背景環境清晰可見，展現療程的專業性與舒適感。' },
      { name: '環境空間圖', description: 'SPA環境全景展示', details: '營造放鬆舒適的整體空間氛圍，展現環境的優雅與專業，包括設施配置與空間設計美感。' },
      { name: '儀器設備圖', description: '專業儀器產品特寫', details: '突出技術先進性與設備專業度，展現儀器的精密設計與高品質製造工藝。' },
      { name: '療程效果圖', description: '前後對比效果展示', details: '視覺化展示療程成效，增加說服力與可信度，展現專業技術的實際效果。' },
      { name: '客戶體驗圖', description: '客戶享受療程的滿足狀態', details: '捕捉客戶在療程中的放鬆表情與滿足感，展現服務品質與客戶滿意度。' },
      { name: '產品介紹圖', description: '高級保養品展示', details: '展示使用的專業產品與保養品，突出產品品質與品牌價值。' },
      { name: '整體包裝圖', description: '課程完整包裝呈現', details: '綜合展現課程的整體價值與吸引力，適合用於宣傳推廣與社群媒體。' }
    ];

    document.addEventListener('DOMContentLoaded', function() {
      loadHistoryFromStorage();
      updateModelSelection();
      initializeFileUpload();
    });

    function loadHistoryFromStorage() {
      try {
        const stored = localStorage.getItem('spaCommandHistory');
        if (stored) {
          commandHistory = JSON.parse(stored);
        }
      } catch (error) {
        console.error('載入歷程失敗:', error);
        commandHistory = [];
      }
    }

    function saveHistoryToStorage() {
      try {
        localStorage.setItem('spaCommandHistory', JSON.stringify(commandHistory));
      } catch (error) {
        console.error('儲存歷程失敗:', error);
        showToast('儲存失敗', 'error');
      }
    }

    function toggleModel(modelNum) {
      const checkbox = document.getElementById(`model${modelNum}`);
      const item = checkbox.parentElement;
      
      event.stopPropagation();
      
      checkbox.checked = !checkbox.checked;
      
      if (checkbox.checked) {
        item.classList.add('selected');
      } else {
        item.classList.remove('selected');
      }
      
      if (modelNum === 12) {
        const customInput = document.getElementById('customModelInput');
        if (checkbox.checked) {
          customInput.style.display = 'block';
        } else {
          customInput.style.display = 'none';
          document.getElementById('customModel').value = '';
        }
      }
      
      updateModelSelection();
    }

    function updateModelSelection() {
      const selectedModels = [];
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        const item = checkbox.parentElement;
        
        if (checkbox.checked) {
          item.classList.add('selected');
          const label = checkbox.nextElementSibling.textContent;
          selectedModels.push(label);
        } else {
          item.classList.remove('selected');
        }
      }
      
      const customModelCheckbox = document.getElementById('model12');
      const customModelText = document.getElementById('customModel').value;
      if (customModelCheckbox.checked && customModelText.trim()) {
        selectedModels[selectedModels.length - 1] = customModelText.trim();
      }
      
      const modelList = document.getElementById('modelList');
      if (selectedModels.length === 0) {
        modelList.textContent = '尚未選擇任何模特類型';
        modelList.style.color = '#6B7280';
      } else {
        modelList.textContent = selectedModels.join('、');
        modelList.style.color = '#1a1d29';
      }
    }

    function handleCustomInput(selectId, inputId) {
      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);
      
      if (select.value === '其他') {
        input.style.display = 'block';
        input.focus();
      } else {
        input.style.display = 'none';
        input.value = '';
      }
    }

    function getSelectedValue(selectId, inputId) {
      const select = document.getElementById(selectId);
      const input = document.getElementById(inputId);
      
      if (select.value === '其他' && input.value.trim()) {
        return input.value.trim();
      }
      return select.value;
    }

    function initializeFileUpload() {
      const fileInput = document.getElementById('machineImage');
      const fileDisplay = fileInput.nextElementSibling;
      
      fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          const fileName = this.files[0].name;
          fileDisplay.innerHTML = `<div style="color: #5B8A72;">✓ 已選擇: ${fileName}</div><div style="font-size: 11px; margin-top: 4px;">系統將智能分析此儀器並生成專業展示圖</div>`;
          fileDisplay.style.borderColor = '#5B8A72';
          fileDisplay.style.background = 'rgba(91, 138, 114, 0.1)';
        } else {
          fileDisplay.innerHTML = `<div>點擊上傳儀器圖片，系統將智能分析並生成專業展示圖</div>`;
          fileDisplay.style.borderColor = 'rgba(0,0,0,0.2)';
          fileDisplay.style.background = 'rgba(255, 255, 255, 0.6)';
        }
      });
    }

    function fillExample() {
      document.getElementById('title').value = '逆時光探雙享SPA';
      document.getElementById('content').value = `**女性任選2部位：腰腹 / 臀腿 / 手臂 男性操作部位：後背 / 肚子**

1. 全背專業手技舒壓 30分鐘
2. 熱旋風舒壓護理 30分鐘
3. 肌力活化雙效儀 20分鐘
4. 腿部淋巴排水 30分鐘
5. 頭部放鬆護理 10分鐘

適合25-50歲追求肌膚年輕化的都會人士
主打逆轉肌齡，重現青春光采`;
      
      document.getElementById('style').value = '極簡';
      document.getElementById('tone').value = '專業';
      document.getElementById('colorTheme').value = '米白灰';
      document.getElementById('lighting').value = '柔光';
      document.getElementById('scene').value = '診間';
      document.getElementById('material').value = '大理石';
      
      document.getElementById('model1').checked = true;
      document.getElementById('model8').checked = true;
      updateModelSelection();
      
      showToast('範例資料已填入', 'success');
    }

    function clearForm() {
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('detailRequirements').value = '';
      
      const selects = document.querySelectorAll('select');
      selects.forEach(select => select.selectedIndex = 0);
      
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        checkbox.checked = false;
      }
      
      document.getElementById('machineImage').value = '';
      document.getElementById('customModel').value = '';
      document.getElementById('customModelInput').style.display = 'none';
      
      const fileDisplay = document.querySelector('.file-display');
      fileDisplay.innerHTML = `<div>點擊上傳儀器圖片，系統將智能分析並生成專業展示圖</div>`;
      fileDisplay.style.borderColor = 'rgba(0,0,0,0.2)';
      fileDisplay.style.background = 'rgba(255, 255, 255, 0.6)';
      
      const customInputs = ['styleOther', 'toneOther', 'colorThemeOther', 'lightingOther', 'sceneOther', 'materialOther'];
      customInputs.forEach(id => {
        const input = document.getElementById(id);
        input.style.display = 'none';
        input.value = '';
      });
      
      document.getElementById('output').innerHTML = `
        <div class="empty-state">
          <div style="font-size: 24px; margin-bottom: 16px; color: #5B8A72;">✨</div>
          <div>點擊「生成專業AI指令」開始創建您的SPA設計指令</div>
        </div>
      `;
      
      updateModelSelection();
      showToast('表單已清空', 'info');
    }

    function parseContentSteps(content) {
      const steps = [];
      const lines = content.split('\n');
      
      lines.forEach(line => {
        const match = line.match(/^\d+\.\s*(.+)/);
        if (match) {
          steps.push(match[1].trim());
        }
      });
      
      return steps.length > 0 ? steps : ['專業SPA療程'];
    }

    function generateMachineAnalysis(machineFile) {
      return `
【儀器展示圖】請參考上傳圖片風格生成3張：
1. 高級美容儀器產品攝影：白色/銀色現代設計，45度展示角度，純白背景，專業攝影棚光線，無文字無logo
2. SPA治療場景：專業治療師操作同款儀器，客人享受療程，溫馨診間環境，自然光線，設計感場景
3. 精品SPA空間：現代美容設備融入高級空間設計，簡約奢華風格，柔和燈光，純粹視覺美感

全部要求：參考上傳儀器外觀特徵，但以設計美感為主，無任何文字標示，純視覺展示。`;
    }

    function generateCommand() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const detailRequirements = document.getElementById('detailRequirements').value;
      
      if (!title || !content) {
        showToast('請填入課程標題和內容', 'error');
        return;
      }

      const style = getSelectedValue('style', 'styleOther');
      const tone = getSelectedValue('tone', 'toneOther');
      const colorTheme = getSelectedValue('colorTheme', 'colorThemeOther');
      const lighting = getSelectedValue('lighting', 'lightingOther');
      const scene = getSelectedValue('scene', 'sceneOther');
      const material = getSelectedValue('material', 'materialOther');
      
      const dimension = document.getElementById('dimension').value;
      const imageCount = parseInt(document.getElementById('imageCount').value);

      const modelOptions = [];
      for (let i = 1; i <= 12; i++) {
        const checkbox = document.getElementById(`model${i}`);
        if (checkbox.checked) {
          if (i === 12) {
            const customText = document.getElementById('customModel').value.trim();
            if (customText) {
              modelOptions.push(customText);
            } else {
              modelOptions.push('其他客製化');
            }
          } else {
            const label = checkbox.nextElementSibling.textContent;
            modelOptions.push(label);
          }
        }
      }

      const courseSteps = parseContentSteps(content);

      let prompt = `請生成${imageCount}張純視覺設計圖片，一次性全部完成：

主題：${title}
風格：${style}${tone}，${colorTheme}色調，${lighting}，${scene}環境
`;

      if (modelOptions.length > 0) {
        prompt += `人物：${modelOptions.join('、')}\n`;
      }

      if (detailRequirements.trim()) {
        prompt += `要求：${detailRequirements}\n`;
      }

      prompt += '\n重要：所有圖片都是純設計感視覺呈現，不包含任何文字、標語、品牌名稱或說明文字。\n\n';

      for (let i = 1; i <= imageCount; i++) {
        const imageType = imageTypes[(i - 1) % imageTypes.length];
        const relatedStep = courseSteps[(i - 1) % courseSteps.length] || '';
        
        prompt += `圖${i}：${imageType.description}，體現"${relatedStep}"療程精神，${colorTheme}色調，${dimension}，設計感背景，無文字純視覺\n`;
      }

      const machineFile = document.getElementById('machineImage').files[0];
      if (machineFile) {
        prompt += '\n' + generateMachineAnalysis(machineFile);
      }

      prompt += '\n立即生成全部圖片，純視覺設計感，無任何文字內容。';

      document.getElementById('output').textContent = prompt;
      saveToHistory(title, prompt);
      showToast(`已生成${imageCount}張純設計圖像指令`, 'success');
    }

    function copyToClipboard() {
      const output = document.getElementById('output');
      if (!output.textContent || output.textContent.includes('點擊「生成專業AI指令」')) {
        showToast('請先生成指令', 'error');
        return;
      }
      
      navigator.clipboard.writeText(output.textContent).then(() => {
        showToast('指令已複製到剪貼簿', 'success');
      }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = output.textContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('指令已複製到剪貼簿', 'success');
      });
    }

    function goToGemini() {
      const output = document.getElementById('output');
      if (!output.textContent || output.textContent.includes('點擊「生成專業AI指令」')) {
        showToast('請先生成指令', 'error');
        return;
      }
      
      copyToClipboard();
      window.open('https://gemini.google.com/', '_blank');
      showToast('已開啟Gemini，指令已複製', 'info');
    }

    function showToast(message, type = 'info') {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function saveToHistory(title, command) {
      const historyItem = {
        id: Date.now(),
        title: title,
        command: command,
        timestamp: new Date().toLocaleString('zh-TW')
      };
      
      commandHistory.unshift(historyItem);
      
      if (commandHistory.length > 20) {
        commandHistory = commandHistory.slice(0, 20);
      }
      
      saveHistoryToStorage();
    }

    function openHistoryModal() {
      const modal = document.getElementById('historyModal');
      modal.style.display = 'block';
      renderHistoryContent();
      
      modal.onclick = function(event) {
        if (event.target === modal) {
          closeHistoryModal();
        }
      };
    }

    function closeHistoryModal() {
      const modal = document.getElementById('historyModal');
      modal.style.display = 'none';
      selectedHistoryItems = [];
    }

    function renderHistoryContent() {
      const content = document.getElementById('historyContent');
      
      if (commandHistory.length === 0) {
        content.innerHTML = `
          <div style="text-align: center; color: #6B7280; padding: 40px;">
            <div style="font-size: 32px; margin-bottom: 16px;">📝</div>
            <div>尚無歷程記錄</div>
          </div>
        `;
        return;
      }
      
      let html = `
        <div class="history-control-panel">
          <div>
            <span style="font-size: 14px; font-weight: 500;">共 ${commandHistory.length} 筆記錄</span>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-danger" onclick="clearAllHistory()" style="font-size: 11px; padding: 6px 12px;">清空全部</button>
          </div>
        </div>
      `;
      
      commandHistory.forEach((item, index) => {
        html += `
          <div class="history-row" onclick="showHistoryDetail(${index})">
            <div style="flex: 1;">
              <div style="font-weight: 500; color: #1a1d29; margin-bottom: 4px; font-size: 14px;">${item.title}</div>
              <div style="font-size: 12px; color: #6B7280;">${item.timestamp}</div>
            </div>
          </div>
        `;
      });
      
      content.innerHTML = html;
    }

    function showHistoryDetail(index) {
      const item = commandHistory[index];
      const content = document.getElementById('historyContent');
      
      content.innerHTML = `
        <div>
          <button class="btn btn-primary" onclick="renderHistoryContent()" style="margin-bottom: 16px;">← 返回列表</button>
          <h4 style="margin-bottom: 8px; color: #1a1d29; font-weight: 600;">${item.title}</h4>
          <p style="color: #6B7280; font-size: 12px; margin-bottom: 16px;">${item.timestamp}</p>
          <div style="background: rgba(26, 29, 41, 0.05); padding: 16px; border-radius: 12px; font-family: monospace; font-size: 11px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; border: 1px solid rgba(0,0,0,0.08);">${item.command}</div>
          <div style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="loadHistoryCommand(${index})">載入指令</button>
            <button class="btn btn-success" onclick="copyHistoryCommand(${index})">複製指令</button>
            <button class="btn btn-danger" onclick="deleteHistoryItem(${index})">刪除此項</button>
          </div>
        </div>
      `;
    }

    function deleteHistoryItem(index) {
      try {
        if (!commandHistory || !commandHistory[index]) {
          showToast('找不到要刪除的項目', 'error');
          return;
        }
        
        if (confirm('確定要刪除這個項目嗎？')) {
          commandHistory.splice(index, 1);
          localStorage.setItem('spaCommandHistory', JSON.stringify(commandHistory));
          renderHistoryContent();
          showToast('項目已成功刪除', 'success');
        }
      } catch (error) {
        showToast('刪除失敗，請重新整理頁面後再試', 'error');
        console.error('刪除錯誤:', error);
      }
    }

    function loadHistoryCommand(index) {
      const item = commandHistory[index];
      document.getElementById('output').textContent = item.command;
      closeHistoryModal();
      showToast('歷程指令已載入', 'success');
    }

    function copyHistoryCommand(index) {
      const item = commandHistory[index];
      
      navigator.clipboard.writeText(item.command).then(() => {
        showToast('歷程指令已複製', 'success');
      });
    }

    function clearAllHistory() {
      commandHistory = [];
      try {
        localStorage.removeItem('spaCommandHistory');
      } catch (error) {
        console.error('清除儲存失敗:', error);
      }
      renderHistoryContent();
      showToast('所有歷程已清空', 'info');
    }

    // 全域函數定義 - 確保函數可以被 onclick 調用
    window.fillExample = fillExample;
    window.clearForm = clearForm;
    window.openHistoryModal = openHistoryModal;
    window.closeHistoryModal = closeHistoryModal;
    window.renderHistoryContent = renderHistoryContent;
    window.showHistoryDetail = showHistoryDetail;
    window.deleteHistoryItem = deleteHistoryItem;
    window.loadHistoryCommand = loadHistoryCommand;
    window.copyHistoryCommand = copyHistoryCommand;
    window.clearAllHistory = clearAllHistory;
    window.generateCommand = generateCommand;
    window.copyToClipboard = copyToClipboard;
    window.goToGemini = goToGemini;
    window.toggleModel = toggleModel;
    window.handleCustomInput = handleCustomInput;
    document.addEventListener('DOMContentLoaded', function() {
      const customModelTextarea = document.getElementById('customModel');
      if (customModelTextarea) {
        customModelTextarea.addEventListener('input', updateModelSelection);
      }
    });

    // 監聽按鍵事件
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('historyModal');
        if (modal && modal.style.display === 'block') {
          closeHistoryModal();
        }
      }
    });

    // 防止checkbox點擊時觸發父元素事件
    document.addEventListener('DOMContentLoaded', function() {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', function(event) {
          event.stopPropagation();
        });
      });
    });

    console.log('SPA設計指令生成器已載入完成');
  </script>
</body>
</html>